FIND_PACKAGE (Qt4 REQUIRED)
SET (QT_USE_QTDBUS 1)

INCLUDE (${QT_USE_FILE})
INCLUDE_DIRECTORIES (. .. ../common ${QT_INCLUDES} ${CMAKE_CURRENT_BINARY_DIR})

ADD_DEFINITIONS (-DSCREENS_FACTORY=libkephal_factory)
ADD_DEFINITIONS (-DOUTPUTS_FACTORY=libkephal_factory)

SET (libkephal_SRCS libkephal.cpp ../screens/screens.cpp ../screens/screen.cpp
        ../screens/simplescreen.cpp
        ../screens/dbus/dbusscreens.cpp
        ../screens/output/outputscreens.cpp
        ../outputs/simpleoutput.cpp
        ../outputs/dbus/dbusoutputs.cpp
        ../outputs/desktopwidget/desktopwidgetoutputs.cpp
        ../outputs/outputs.cpp)
QT4_WRAP_CPP (libkephal_SRCS ../screens/screens.h ../screens/simplescreen.h
        ../screens/screen.h ../screens/dbus/dbusscreens.h
        ../screens/output/outputscreens.h
        ../outputs/simpleoutput.h
        ../outputs/dbus/dbusoutputs.h
        ../outputs/desktopwidget/desktopwidgetoutputs.h
        ../outputs/outputs.h)
QT4_ADD_DBUS_INTERFACE(libkephal_SRCS ${CMAKE_CURRENT_BINARY_DIR}/../kephald/org.kde.Kephal.Screens.xml screens_interface)
QT4_ADD_DBUS_INTERFACE(libkephal_SRCS ${CMAKE_CURRENT_BINARY_DIR}/../kephald/org.kde.Kephal.Outputs.xml outputs_interface)
ADD_LIBRARY (kephal SHARED ${libkephal_SRCS})
INSTALL (TARGETS kephal DESTINATION lib)
INSTALL (FILES 
        ../screens/screens.h ../screens/screen.h
        ../outputs/outputs.h ../common/kephal.h
        DESTINATION include/kephal)
INSTALL (FILES FindKephal.cmake DESTINATION share/apps/cmake/modules)